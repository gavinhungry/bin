#!/bin/bash
#
# Name: rdp
# Auth: Gavin Lloyd
# Desc: Profile wrapper for Remote Desktop (rdesktop)
#

source $(dirname "${BASH_SOURCE}")/abash/abash.sh
[ $# -eq 1 ] || usage "PROFILE"

PROFILE=$1
PROFILE_DIR=$HOME/.rdp

[ -d $PROFILE_DIR ] || die "profile directory '$PROFILE_DIR' does not exist"
[ -e $PROFILE_DIR/$PROFILE ] || die "profile '$PROFILE' does not exist"

source $PROFILE_DIR/$PROFILE

[ ! -z $SERVER ] || die "'$PROFILE' has no server specified"
[ ! -z $USERNAME ] || die "'$PROFILE' has no user specified"

OPTIONS=""
[ ! -z $DOMAIN ] && OPTIONS+=" -d $DOMAIN"
# [ ! -z $PASSWORD_KEYRING ] && OPTIONS+=" -p $(gnome-keyring-query get ${PASSWORD_KEYRING})"

echo "Connecting to $SERVER as ${DOMAIN}\\${USERNAME}"
rdesktop $SERVER -u $USERNAME $OPTIONS -g 1280x800 -a 16 -k en-us -x l
