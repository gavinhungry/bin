#!/bin/bash
#
# Name: surveil
# Auth: Gavin Lloyd <gavinhungry@gmail.com>
# Desc: Surveil file(s) and execute command when modified
#
# Example: surveil file.less "lessc file.less file.css"
#

source $(dirname "${BASH_SOURCE}")/abash/abash.sh
[ $# -ge 1 ] || usage "FILES \"COMMAND\""

FILES=${@:1:$(($#-1))}
COMMAND=${@: -1}

for FILE in $FILES; do
  [ -r $FILE ] || die "Cannot read surveillance target: $FILE"
done

while true; do
  inotifywait -qqe modify $FILES && eval $COMMAND || sleep 1
done
