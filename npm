#!/bin/bash

source $(dirname "${BASH_SOURCE[0]}")/abash/abash.sh

NPM=${NPM:-/usr/local/bin/npm}
[ -x "$NPM" ] || die "cannot execute $NPM"

if arge global; then
  if [ $# -eq 2 -a "$2" == 'soft-update' ]; then
    PKGS=$(npm -g list --depth=0 2> /dev/null)
    for pkg in $(npm -g outdated --parseable --depth=0 | cut -d: -f4); do
      echo "$PKGS" | grep -q "\s${pkg}$" || sudo $NPM -g install "$pkg"
    done
  else
    sudo $NPM "$@"
  fi
else
  $NPM "$@"
fi
