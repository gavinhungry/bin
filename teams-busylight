#!/bin/bash

declare -A STATUS_COLOR_MAP
STATUS_COLOR_MAP[online]='#020'
STATUS_COLOR_MAP[AppearAway]='#210'
STATUS_COLOR_MAP[busy]='#002'
STATUS_COLOR_MAP[outToLunch]='#002'
STATUS_COLOR_MAP[beRightBack]='#111'
STATUS_COLOR_MAP[InCall]='#200'

LAST_COLOR=

while read STATUS; do
  if [ -z "$STATUS" -o "$STATUS" == 'offline' ]; then
    LAST_COLOR=
    busylight off
    continue
  fi

  STATUS_COLOR=${STATUS_COLOR_MAP[$STATUS]}
  if [ -z "$STATUS_COLOR" ]; then
    echo "Unknown status: $STATUS"
    continue
  fi

  [ "$STATUS_COLOR" == "$LAST_COLOR" ] && continue

  busylight on "$STATUS_COLOR"
  LAST_COLOR=$STATUS_COLOR
done < <(teams-status --watch)
