#!/bin/bash

declare -A STATUS_COLOR_MAP
STATUS_COLOR_MAP[online]='#030'
STATUS_COLOR_MAP[AppearAway]='#410'
STATUS_COLOR_MAP[busy]='#003'
STATUS_COLOR_MAP[outToLunch]='#300'
STATUS_COLOR_MAP[beRightBack]='#222'
STATUS_COLOR_MAP[InCall]='#300'

LAST_COLOR=

while read STATUS; do
  if [ -z "$STATUS" -o "$STATUS" == 'offline' ]; then
    LAST_COLOR=
    busylight off
    continue
  fi

  STATUS_COLOR=${STATUS_COLOR_MAP[$STATUS]}
  if [ -z "$STATUS_COLOR" ]; then
    echo "Unknown status: $STATUS"
    continue
  fi

  [ "$STATUS_COLOR" == "$LAST_COLOR" ] && continue

  busylight on "$STATUS_COLOR"
  LAST_COLOR=$STATUS_COLOR
done < <(teams-status --watch)
